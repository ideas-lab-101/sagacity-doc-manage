<?xml version="1.0" encoding="UTF-8"?>
<sqlGroup name="doc">
	<sql id="getMainList">
        select m.id, m.title, m.page, m.cover, m.type_id, m.open_type
        from main m
        where m.state=1 and m.type_id=?
        order by m.order DESC
	</sql>
	<sql id="getClassList">
        select dc.id, dc.title,dc.desc,dc.icon
        from doc_class dc
        where dc.state=1 and index_show=?
        order by dc.order DESC
	</sql>
    <sql id="getDocList-select">
        select doc.id,doc.title,doc.desc,doc.cover,doc.doc_class_id,dc.title class_title,doc.user_id,u.Caption,doc.source
        ,IFNULL(dpc.page_count,0) page_count,SUBSTR(doc.created_at,1,10) create_date,doc.state,doc.is_hot
    </sql>
    <sql id="getDocList-from">
        from doc_info doc
        left join (select count(id) page_count,doc_id from doc_page group by doc_id) dpc on dpc.doc_id=doc.id
        left join doc_class dc on dc.id=doc.doc_class_id
        left join sys_users u on u.UserID=doc.user_id
    </sql>
    <sql id="getDocInfo">
        select doc.id,doc.title,doc.desc,doc.cover,doc.doc_class_id,dc.title class_title,doc.user_id,doc.source
        ,IFNULL(u.Caption,'未知') Caption
        from doc_info doc
        left join doc_class dc on dc.id=doc.doc_class_id
        left join sys_users u on u.UserID=doc.user_id
        where doc.id=?
    </sql>
</sqlGroup>

